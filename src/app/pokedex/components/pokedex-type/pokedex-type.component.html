<div class="dex-scene">
  <div class="dex-card">

    @if (current(); as cur) {
      <div class="dex-header">
        <div class="dex-button" aria-hidden="true"></div>
        <div class="dex-lights" aria-hidden="true">
          <span class="led led-red"></span>
          <span class="led led-yellow"></span>
          <span class="led led-green"></span>
        </div>
        <h1 [style.color]="cur.color">{{ cur.name }}</h1>
      </div>

      <div class="dex-body">
        <div class="dex-screen type-page" [style.--type-color]="cur.color">

          <nav class="quick-nav">
            <a class="nav-chip nav-green"   routerLink="/pokedex/docs"            title="Retour">
              üîô <span>Retour</span>
            </a>
            <a class="nav-chip nav-blue"    routerLink="/pokedex/pokemons"      title="Liste des Pok√©mons">
              üß¨ <span>Pok√©mons</span>
            </a>
            <a class="nav-chip nav-red" routerLink="/pokedex/moves"  title="Liste des Capacit√©s">
              ‚ö° <span>Capacit√©s</span>
            </a>
            <a class="nav-chip nav-yellow"  routerLink="/pokedex/abilities"       title="Liste des Talents">
              ‚ú® <span>Talents</span>
            </a>
          </nav>

          <!-- Bandeau r√©sum√© du type courant -->
          <section class="type-hero">
            <div class="hero-inner">
              <div class="hero-header">
                <div class="hero-label">Type</div>
                <div class="hero-type-badge"
                     [style.--hero-color]="cur.color">
                  {{ cur.name }}
                </div>
              </div>

              <div class="hero-meta">
                <div class="meta-block">
                  <div class="meta-title">Forces offensives</div>
                  <div class="meta-chips">
                    @for (x of attack()?.dbl; track x) {
                      <span class="chip tiny" [ngStyle]="styleFor(x)">{{ x }}</span>
                    }
                  </div>
                </div>

                <div class="meta-block">
                  <div class="meta-title">Forces d√©fensives</div>
                  <div class="meta-chips">
                    @for (x of defense()?.half; track x) {
                      <span class="chip tiny" [ngStyle]="styleFor(x)">{{ x }}</span>
                    }
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Liste des types (s√©lecteur lat√©ral) -->
          <nav class="types-panel">
            <h2>Types</h2>
            <div class="types-grid">
              @for (t of allTypes(); track t.slug) {
                <a class="type-chip"
                   [routerLink]="['/pokedex/types', t.slug]"
                   [class.active]="t.slug === cur.slug"
                   [style.--type-color]="t.color">
                  {{ t.name }}
                </a>
              }
            </div>
          </nav>

          <!-- Table des affinit√©s -->
          <section class="eff card-surface">
            <h2 class="section-title">Table des affinit√©s</h2>

            <div class="eff-row">
              <h3>En d√©fense (cible = {{ cur.name }})</h3>

              <div class="bucket">
                <div class="bucket-title good">R√©siste x0.5</div>
                <div class="chips">
                  @for (x of defense()?.half; track x) {
                    <span class="chip" [ngStyle]="styleFor(x)">{{ x }}</span>
                  }
                </div>
              </div>

              <div class="bucket">
                <div class="bucket-title bad">Faible x2</div>
                <div class="chips">
                  @for (x of defense()?.dbl; track x) {
                    <span class="chip" [ngStyle]="styleFor(x)">{{ x }}</span>
                  }
                </div>
              </div>

              @if (defense()?.zero?.length) {
                <div class="bucket">
                  <div class="bucket-title immune">Immunis√© x0</div>
                  <div class="chips">
                    @for (x of defense()?.zero; track x) {
                      <span class="chip" [ngStyle]="styleFor(x)">{{ x }}</span>
                    }
                  </div>
                </div>
              }
            </div>

            <div class="eff-row">
              <h3>En attaque ({{ cur.name }} ‚Üí cible)</h3>

              <div class="bucket">
                <div class="bucket-title good">Efficace x2</div>
                <div class="chips">
                  @for (x of attack()?.dbl; track x) {
                    <span class="chip" [ngStyle]="styleFor(x)">{{ x }}</span>
                  }
                </div>
              </div>

              <div class="bucket">
                <div class="bucket-title warn">Peu efficace x0.5</div>
                <div class="chips">
                  @for (x of attack()?.half; track x) {
                    <span class="chip" [ngStyle]="styleFor(x)">{{ x }}</span>
                  }
                </div>
              </div>

              @if (attack()?.zero?.length) {
                <div class="bucket">
                  <div class="bucket-title immune">Sans effet x0</div>
                  <div class="chips">
                    @for (x of attack()?.zero; track x) {
                      <span class="chip" [ngStyle]="styleFor(x)">{{ x }}</span>
                    }
                  </div>
                </div>
              }
            </div>
          </section>

          <!-- Caract√©ristiques du type -->
          <section class="caracs card-surface">
            <h2 class="section-title">Caract√©ristiques</h2>

            @if (cur.characteristics.length) {
              <ul class="carac-list">
                @for (c of cur.characteristics; track $index) {
                  <li>{{ c }}</li>
                }
              </ul>
            } @else {
              <p>Aucune caract√©ristique renseign√©e pour l'instant.</p>
            }
          </section>

          <!-- Pok√©mon de ce type -->
          <section class="of-type card-surface">
            <h2 class="section-title">Pok√©mon de type {{ cur.name }}</h2>

            @if (pokemonsOfType(); as list) {
              @if (list.length) {
                <div class="table-scroll" role="region" aria-label="Table Pok√©dex d√©filable" tabindex="0">
                  <table class="pokedex-table pokedex-table--compact">
                    <thead>
                      <tr>
                        <th style="width:5rem">#</th>
                        <th></th>
                        <th>Nom</th>
                        <th style="width:18rem">Type</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for (p of list; track p.id) {
                        <tr>
                          <td>#{{ p.id.toString().padStart(3,'0') }}</td>
                          <td>
                            <a [routerLink]="['/pokedex', p.id]" class="sprite-link" title="Voir {{p.name}}">
                              <img [src]="p.images.sprite" [alt]="p.name" loading="lazy" />
                            </a>
                          </td>
                          <td><a [routerLink]="['/pokedex', p.id]">{{ p.name }}</a></td>
                          <td>
                            @for (t of typesOf(p); track t) {
                              <a
                                class="chip chip--small chip-link"
                                [routerLink]="['/pokedex/types', t.toLowerCase()]"
                                [ngStyle]="styleFor(t)"
                                title="Voir le type {{ t }}"
                              >
                                {{ t }}
                              </a>
                            }
                          </td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              } @else {
                <p>Aucun Pok√©mon de ce type pour l'instant.</p>
              }
            }
          </section>

        </div>
      </div>
    } @else {
      <div class="dex-body">
        <div class="dex-screen"><p>Chargement‚Ä¶</p></div>
      </div>
    }

  </div>
</div>
